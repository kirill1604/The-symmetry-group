# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã REINVENT4

–ú–æ–¥–µ–ª—å:

$$P_\theta(T \mid S) = \prod_{i=1}^{L} P_\theta(t_i \mid t_{\text{<}i}, S)$$

–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫—Ä–æ—Å—Å-—ç–Ω—Ç—Ä–æ–ø–∏–π–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å:

$$\mathcal{Loss} = -\sum_{(S,T)\in D}\ln P_\theta(T \mid S)$$

–≥–¥–µ $D$ ‚Äî –Ω–∞–±–æ—Ä –ø–∞—Ä ¬´–∏—Å—Ö–æ–¥–Ω–∏–∫‚Äì–∞–Ω–∞–ª–æ–≥¬ª —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º —Å—Ö–æ–¥—Å—Ç–≤–∞.

## –°—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `Mol2Mol`

Mol2Mol ‚Äî —ç—Ç–æ —É—Å–ª–æ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞ –≤—Ö–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é –º–æ–ª–µ–∫—É–ª—É \(S\) –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –ø–æ—Ö–æ–∂—É—é –º–æ–ª–µ–∫—É–ª—É \(T\).  
–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏–±–æ —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π multinomial-sampling (–Ω–∞—à —Å–ª—É—á–∞–π), –ª–∏–±–æ beam-search. –ü—Ä–∏ —ç—Ç–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π $T$:

$$P_T(t_i) = \frac{\exp\bigl(\ln P_\theta(t_i \mid t_{\text{<}i}, S)/T\bigr)} {\sum_{u}\exp\bigl(\ln P_\theta(u \mid t_{\text{<}i}, S)/T\bigr)}$$

- $T<1$ –¥–µ–ª–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ ¬´–æ—Å—Ç—Ä—ã–º¬ª –∏ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º.  
- $T>1$ —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, —É–≤–µ–ª–∏—á–∏–≤–∞—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ.

–í beam-search —Ö—Ä–∞–Ω–∏–º $k$ –ª—É—á—à–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ —Å—É–º–º–µ –ª–æ–≥-—Å–∫–æ—Ä:

$$\text{score}(t_{1:i}) = \sum_{j=1}^{i} \ln P_\theta\bigl(t_j \mid t_{\text{<}j}, S\bigr).$$

### Pipeline –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. –í—Ö–æ–¥: —Å–ø–∏—Å–æ–∫ SMILES —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –ª–∏–≥–∞–Ω–¥–æ–≤ $S$.  
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: –∏–∑ –∫–∞–∂–¥–æ–≥–æ $S$ –ø–æ–ª—É—á–∞–µ–º –∞–Ω–∞–ª–æ–≥ $T\sim P_T(\cdot\mid S)$.  
3. –í—ã—Ö–æ–¥: –Ω–∞–±–æ—Ä –º–æ–ª–µ–∫—É–ª $\{T\}$, –≥–æ—Ç–æ–≤—ã—Ö –∫ downstream-—Å–∫—Ä–∏–Ω–≥—É –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

Prior `mol2mol_medium_similarity.prior` –±—ã–ª –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—É—á–µ–Ω –Ω–∞ –ø–∞—Ä–∞—Ö $(S,T)$ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º Tanimoto-—Å—Ö–æ–¥—Å—Ç–≤–∞, –ø–æ—ç—Ç–æ–º—É –º–æ–¥–µ–ª—å —É–º–µ–µ—Ç –≤–Ω–æ—Å–∏—Ç—å —Ö–∏–º–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (R-–≥—Ä—É–ø–ø—ã, –∫–æ–ª—å—Ü–∞, —Ö–∏—Ä–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã) –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Ö–æ–∂–µ—Å—Ç–∏.

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã scoring`–∞

$$\text{Reward} = \left( \prod_{i=1}^{N} S_i^{w_i} \right)^{\frac{1}{\sum_{i=1}^{N} w_i}}$$

–≥–¥–µ:  
- $S_i$ ‚Äî —Å–∫–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏  
- $w_i$ ‚Äî –≤–µ—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞  
- $N$ ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–≤–µ—Å $> 0$ )  

**OR**

$$\text{Reward} = \left(\prod_{i=1}^{N} \bigl(T_{i}(x_{i})\bigr)^{w_{i}}\right)^{\frac{1}{\sum_{i=1}^{N}w_{i}}} \ =\  \exp\ \Biggl(\frac{\sum_{i=1}^{N}w_{i}\,\ln\bigl(T_{i}(x_{i})\bigr)}{\sum_{i=1}^{N}w_{i}}\Biggr)$$

–≥–¥–µ:  
- $x_{i}$ ‚Äî —Å—ã—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ $i$-–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞,  
- $T_{i}(x_{i})$ ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è ($\text{sigmoid}$, $\text{step}$, $\text{value mapping}$ –∏ —Ç. –¥.) –Ω–æ—Ä–º–∏—Ä—É—é—â–∞—è $x_{i}$ –≤ $(0,1]$,  
- $w_i$ ‚Äî –≤–µ—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞,  
- $N$ ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–≤–µ—Å $> 0$ )  

[CONFIG FILE](./configs/REINVENT4_scoring_config.toml)

| üí° –ö–∞—Ç–µ–≥–æ—Ä–∏—è                | üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                         | ‚öñÔ∏è –í–µ—Å w·µ¢ | üîÑ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è                                                                 | üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                        | üìè –•–∏–º–∏–∫–æ-–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤                |
|------------------------------|-------------------------------------|-----------|----------------------------------------------------------------------------------|-------------------------------------------------------|----------------------------------------------------------------|
| Drug-likeness                | QED                                 | 1.0       | ‚Äî                                                                                | –û–±—â–∞—è ¬´–º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–∑–Ω–æ—Å—Ç—å¬ª                             |        |
| Lipophilicity                | SlogP (RDKit)                       | 1.0       | reverse_sigmoid (low = 1.4, high = 3.0, k = 0.4)                                  | –õ–∏–ø–æ—Ñ–∏–ª—å–Ω–æ—Å—Ç—å                                          | logP 1.4‚Äì3.0 ‚Äî –æ–ø—Ç–∏–º—É–º –º–µ–∂–¥—É —Ä–∞—Å—Ç–≤–æ—Ä–∏–º–æ—Å—Ç—å—é –∏ –ø—Ä–æ–Ω–∏—Ü–∞–µ–º–æ—Å—Ç—å—é  |
| Size & Permeability          | MolecularWeight                     | 1.0       | double_sigmoid (low = 200, high = 500, coef_div = 500, coef_si = 20, coef_se = 20) | –ú–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞—è –º–∞—Å—Å–∞                                     | 200‚Äì500 Da ‚Äî –æ–ø—Ç–∏–º—É–º –¥–ª—è –ø–µ—Ä–æ—Ä–∞–ª—å–Ω–æ–π –±–∏–æ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ BBB       |
| Polarity & BBB               | TPSA                                | 0.9       | double_sigmoid (low = 20, high = 90, coef_div = 70, coef_si = 15, coef_se = 15)   | –ü–æ–ª—è—Ä–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å                                   | < 90 √Ö¬≤ ‚Äî –≤—ã—Å–æ–∫–∞—è BBB-–ø—Ä–æ–Ω–∏—Ü–∞–µ–º–æ—Å—Ç—å; < 140 √Ö¬≤ ‚Äî –ø–µ—Ä–æ—Ä–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å    |
| Stereochemistry              | Number of stereo centers            | 0.7       | step (low = 0, high = 3)                                                         | –•–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å                                            | 0‚Äì3 —Ü–µ–Ω—Ç—Ä–∞ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è —Å—Ç–µ—Ä–µ–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å             |
| Hydrogen bonding             | HBondAcceptors                      | 0.8       | reverse_sigmoid (low = 5, high = 8, k = 0.5)                                      | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–µ–ø—Ç–æ—Ä–æ–≤ H-—Å–≤—è–∑–µ–π                        | 5‚Äì8 ‚Äî –æ–ø—Ç–∏–º—É–º –¥–ª—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –º–µ–º–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞      |
| Hydrogen bonding             | HBondDonors                         | 0.8       | reverse_sigmoid (low = 0, high = 3, k = 0.5)                                      | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–Ω–æ—Ä–æ–≤ H-—Å–≤—è–∑–µ–π                            | 0‚Äì3 ‚Äî –±–∞–ª–∞–Ω—Å –≤–æ–¥–æ—Ä–æ–¥–Ω—ã—Ö —Å–≤—è–∑–µ–π –∏ –ø—Ä–æ–Ω–∏—Ü–∞–µ–º–æ—Å—Ç–∏                |
| Flexibility                  | Number of rotatable bonds           | 0.7       | reverse_sigmoid (low = 0, high = 10, k = 0.5)                                     | –ì–∏–±–∫–æ—Å—Ç—å –º–æ–ª–µ–∫—É–ª—ã                                       | ‚â§ 10 ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏        |
| 3D –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å              | Csp3                                | 0.6       | reverse_sigmoid (low = 0, high = 15, k = 0.5)                                     | –î–æ–ª—è sp¬≥-—É–≥–ª–µ—Ä–æ–¥–æ–≤                                     | 0‚Äì15 ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–Ω–æ—Å—Ç–∏ –∏ –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏     |
| Hybridization                | Number of sp atoms                  | 0.6       | reverse_sigmoid (low = 0, high = 20, k = 0.5)                                     | –ñ—ë—Å—Ç–∫–æ—Å—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤                                   | sp –∞—Ç–æ–º–∞ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–Ω–æ—Å—Ç—å –∏ œÄ-—Å–∏—Å—Ç–µ–º—ã                   |
| Hybridization                | Number of sp¬≤ atoms                 | 0.4       | reverse_sigmoid (low = 0, high = 20, k = 0.5)                                     | –ü–ª–æ—Å–∫–æ—Å—Ç–Ω–æ—Å—Ç—å                                          | sp¬≤ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—é—Ç œÄ-—Å–≤—è–∑–∏ –∏ –∞—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã               |
| Hybridization                | Number of sp¬≥ atoms                 | 0.6       | reverse_sigmoid (low = 0, high = 20, k = 0.5)                                     | 3D-–Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å                                        | sp¬≥ ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—ä—ë–º –∏ –≥–∏–±–∫–æ—Å—Ç—å                            |
| Size                         | Number of heavy atoms               | 0.6       | reverse_sigmoid (low = 20, high = 64, k = 0.5)                                    | –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –º–æ–ª–µ–∫—É–ª—ã                                   | 20‚Äì64 –∞—Ç–æ–º–∞ ‚Äî –æ–ø—Ç–∏–º—É–º –¥–ª—è drug-likeness –∏ BBB                 |
| Polarity                     | Number of heteroatoms               | 0.6       | reverse_sigmoid (low = 6, high = 30, k = 0.5)                                     | –ü–æ–ª—è—Ä–Ω—ã–µ –∞—Ç–æ–º—ã                                         | 6‚Äì30 ‚Äî –±–∞–ª–∞–Ω—Å –ø–æ–ª—è—Ä–Ω–æ—Å—Ç–∏ –∏ –ª–∏–ø–æ—Ñ–∏–ª—å–Ω–æ—Å—Ç–∏                      |
| Rigidity                      | Number of rings                     | 0.8       | reverse_sigmoid (low = 0, high = 7, k = 0.5)                                      | –¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å                                            | 0‚Äì7 –∫–æ–ª–µ—Ü ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∂—ë—Å—Ç–∫–æ—Å—Ç—å –∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å             |
| Aromaticity                  | Number of aromatic rings            | 0.8       | reverse_sigmoid (low = 0, high = 3, k = 0.5)                                      | –ê—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ª—å—Ü–∞                                   | 0‚Äì3 –∫–æ–ª—Ü–∞ ‚Äî œÄ-œÄ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å                |
| Aliphatic character           | Number of aliphatic rings           | 1.0       | reverse_sigmoid (low = 0, high = 3, k = 0.5)                                      | –ê–ª–∏—Ñ–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ü–∏–∫–ª—ã                                    | 0‚Äì3 –∫–æ–ª—Ü–∞ ‚Äî –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞—Å—Ç–≤–æ—Ä–∏–º–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å            |
| Molecular volume             | Moleculer Volume (RDKit)            | 1.0       | reverse_sigmoid (low = 300, high = 600, k = 0.5)                                   | –û–±—ä—ë–º –º–æ–ª–µ–∫—É–ª—ã                                         | 300‚Äì600 √Ö¬≥ ‚Äî –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–∑–º–µ—Ä–æ–º –∏ –ø—Ä–æ–Ω–∏—Ü–∞–µ–º–æ—Å—Ç—å—é BBB       |
| Filters                      | Group (substructure) count [F,Cl]   | 1.0       | reverse_sigmoid (low = 1, high = 3, k = 0.5)                                      | –°—á—ë—Ç—á–∏–∫ –≥–∞–ª–æ–≥–µ–Ω–æ–≤                                      | > 3 ‚Äî –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∏ –ø–ª–æ—Ö–æ–π ADME                |
| Filters                      | custom alerts                       | 1.0       | –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä                                                                 | SMARTS-–ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—Ç–±–æ—Ä–∞                                | –û—Ç—Å–µ–∫–∞–µ—Ç —Ç–æ–∫—Å–∏—á–Ω—ã–µ/–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã                      |
| Similarity                   | Tanimoto similarity to reference    | 0.8       | ‚Äî                                                                                | ECFP6-—Å—Ö–æ–¥—Å—Ç–≤–æ                                          | 0.7‚Äì1.0 ‚Äî –±–ª–∏–∑–∫–∏–µ –∞–Ω–∞–ª–æ–≥–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏            |
| Synthetic accessibility      | SA score (SAScore)                  | 1.0       | ‚Äî                                                                                | –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å                              |        |
